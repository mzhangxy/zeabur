name: Zeabur Auto Restart

on:
  schedule:
    - cron: '0 0 */7 * *'  # 每7天
  workflow_dispatch:

jobs:
  restart:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Zeabur Service Restart
        run: |
          RESPONSE=$(curl -s -X POST https://api.zeabur.com/graphql \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.ZEABUR_API_KEY }}" \
            -d '{
              "query": "mutation { restartService(serviceID: "${{ secrets.ZEABUR_SERVICE_ID }}") }",
              "variables": {}
            }')
          echo "Zeabur Response: $RESPONSE"
          # 检查是否成功
          if echo "$RESPONSE" | grep -q '"data":'; then
            echo "Restart triggered successfully."
          else
            echo "Error in restart."
            exit 1
          fi
